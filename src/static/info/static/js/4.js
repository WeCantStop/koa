webpackJsonp([4],{"0xDb":function(e,t,a){"use strict";a.d(t,"a",function(){return l});var l=function(e,t,a){var l;return function(){var i=this,s=arguments;if(l&&clearTimeout(l),a){var r=!l;l=setTimeout(function(){l=null},t),r&&e.apply(i,s)}else l=setTimeout(function(){e.apply(i,s)},t)}}},GWQE:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var l=a("woOf"),i=a.n(l),s=a("Dd8w"),r=a.n(s),o=a("t5DY"),n=a("myXI"),c=a("0xDb"),u=a("MznX"),p={data:function(){return{labelList:[],formValidate:{topicName:{required:!0,message:"请输入专题名称",trigger:"blur"},topicAbstract:{required:!0,message:"请输入专题摘要",trigger:"blur"},articleList:{required:!1,message:'请输入文章列表(多条资讯使用英文逗号","隔开)',trigger:"blur"},topicCover:{required:!0,message:"请上传专题封面",trigger:"blur"},weight:{required:!0,message:"请填写权重",trigger:"blur"},status:{required:!0,message:"请选择状态",trigger:"blur"}},ajaxUrl:n,uploadServer:n.uploadArticleImage,dialogVisiblePage:!1,filters:{status:"",type:""},specialStatus:[{label:"全部",value:""},{label:"上线",value:"01"},{label:"下线",value:"02"}],subForm:{topicName:"",topicAbstract:"",articleList:"",topicCover:"",status:"",weight:"",dateTimeRange:[],onlineDateStart:"",onlineDateEnd:""},previewArticleData:{isShow:!1,qrBase64:""},options:[{value:"01",label:"上线"},{value:"02",label:"下线"}],subjectTypesWithAll:u.c,subjectTypes:u.b,columnList:[],editSpecialId:null,list:[],imageUrl:"",total:1,pageNum:1,pageSize:10}},created:function(){this.getColumnList()},methods:{debounceFunc:c.a,filter:function(e){this.getList()},getList:function(){var e=this;Object(o.a)(n.pageInfoTopic,r()({pageNum:this.pageNum,pageSize:this.pageSize},this.filters)).then(function(t){"200"===t.returnCode&&(e.list=t.result.list,e.total=t.result.total)})},getColumnList:function(){var e=this;Object(o.a)(n.listInfoDirectory).then(function(t){e.columnList=t.result,e.getList()})},saveSpecial:function(){var e=!1;if(this.$refs.form.validate(function(t){t&&(e=!0)}),!e)return!1;var t=this.ctrlSubmitData(r()({},this.subForm));this.fetchSaveOrUpdate(this.editSpecialId,t)},ctrlSubmitData:function(e){if(e.dateTimeRange&&e.dateTimeRange.length>0&&(e.onlineDateStart=e.dateTimeRange[0],e.onlineDateEnd=e.dateTimeRange[1]),e.labelIds&&e.labelIds.length>0){var t=[];e.labelIds.forEach(function(e){t.push(e)}),e.labelIds=t.join(",")}return e},fetchSaveOrUpdate:function(e,t){var a=this,l=n.saveInfoTopic,s="保存成功",r=t;e&&(l=n.updateInfoTopic,r=i()(t,{topicId:this.editSpecialId}),s="更新成功"),Object(o.a)(l,r).then(function(e){"200"===e.returnCode?(a.getList(),a.$message({message:s,type:"success"}),a.cancelDialog()):a.$message({message:e.returnMsg,type:"error"})})},queryLabels:function(e){var t=this;e?Object(o.a)(n.getLabels,{labelName:e}).then(function(e){t.labelList=e.result}):this.labelList=[]},deleteSpecial:function(e){var t=this;this.$confirm("确定删除选中专题?","提示",{}).then(function(){Object(o.a)(n.deleteInfoTopic,{topicId:e.id}).then(function(e){"200"===e.returnCode&&(t.cancelDialog(),t.getList(),t.$message({message:"删除成功~",type:"success"}))})}).catch(function(){})},changeStatus:function(e,t){var a=this,l="online"===e?"01":"02";Object(o.a)(n.updateTopicStatus,{topicId:t.id,status:l}).then(function(e){"200"===e.returnCode&&(a.cancelDialog(),a.getList(),a.$message({message:"成功",type:"success"}))})},editSpecial:function(e){var t=this;Object(o.a)(n.getInfoTopicById,{topicId:e.id}).then(function(e){if("200"===e.returnCode){var a=e.result;t.editSpecialId=a.id,a.labelIds&&(a.labelIds=a.labelNames.split(",")),t.subForm={topicName:a.topicName,topicAbstract:a.topicAbstract,articleList:a.articleList,topicCover:a.topicCover,status:a.status,weight:a.weight,type:a.type,labelIds:a.labelIds||[],directoryId:a.directoryId,isOpenComments:a.isOpenComments,componentsIds:a.componentsIds},a.onlineDateStart&&(t.subForm=r()({},t.subForm,{onlineDateStart:new Date(a.onlineDateStart),onlineDateEnd:new Date(a.onlineDateEnd),dateTimeRange:[new Date(a.onlineDateStart),new Date(a.onlineDateEnd)]})),t.openDialog()}})},updateSpecial:function(e){var t=this,a=i()(e,{topicId:this.editSpecialId});Object(o.a)(n.updateInfoTopic,a).then(function(e){"200"===e.returnCode?(t.cancelDialog(),t.getList(),t.$message({message:"更新成功~",type:"success"})):t.$message({message:e.returnMsg,type:"error"})})},addNewSpecial:function(){this.subForm={topicName:"",topicAbstract:"",articleList:"",topicCover:"",weight:"",isOpenComments:"01",labelIds:[]},this.editSpecialId=null,this.imageUrl="",this.openDialog()},openDialog:function(){this.dialogVisiblePage=!0},hideDialog:function(){this.$refs.form.clearValidate()},cancelDialog:function(){this.dialogVisiblePage=!1},changePage:function(e){this.pageNum=e.page,this.pageSize=e.rows||10,this.getList()},beforeAvatarUpload:function(){},statusText:function(e){return{"01":"上线","02":"下线"}[e.row.status]},parseType:function(e){return u.b.filter(function(t){return t.value===e.row.type})[0].label},formatterDirectoryName:function(e,t,a){var l=this.columnList.filter(function(e){return e.id==a});return l.length>0?l[0].directoryName:"未分配"},handleAvatarSuccess:function(e,t){console.log(e,t),this.subForm.topicCover=e.result},previewArticle:function(e){var t=this;Object(o.a)(n.getTopicPreview,{topicId:e.id}).then(function(e){200==e.returnCode?(t.previewArticleData.qrBase64="data:image/png;base64,"+e.result,t.previewArticleData.isShow=!0):t.$message({showClose:!0,message:e.returnMsg,type:"error"})})},handleRemove:function(e,t){console.log(e,t)},handlePreview:function(e){console.log(e)},handleExceed:function(e,t){this.$message.warning("当前限制选择 3 个文件，本次选择了 "+e.length+" 个文件，共选择了 "+(e.length+t.length)+" 个文件")},beforeRemove:function(e,t){return this.$confirm("确定移除 "+e.name+"？")},handleSelectionChange:function(e){this.selectionRowData=e}}},d={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("za-page-content",{attrs:{header:"专题管理"}},[a("za-table",{ref:"table",attrs:{data:e.list,"highlight-current-row":"",total:e.total},on:{"action-change":e.changePage,"selection-change":e.handleSelectionChange}},[a("div",{staticStyle:{"padding-bottom":"0px"},attrs:{slot:"searchBar"},slot:"searchBar"},[a("el-form",{ref:"filtersForm",attrs:{model:e.filters}},[a("el-form-item",[a("el-col",{attrs:{span:8}},[a("el-col",{attrs:{span:6}},[e._v("状态:")]),e._v(" "),a("el-col",{attrs:{span:16}},[a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择"},model:{value:e.filters.status,callback:function(t){e.$set(e.filters,"status",t)},expression:"filters.status"}},e._l(e.specialStatus,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}))],1)],1),e._v(" "),a("el-col",{attrs:{span:8}},[a("el-col",{attrs:{span:6}},[e._v("专题样式:")]),e._v(" "),a("el-col",{attrs:{span:16}},[a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择"},model:{value:e.filters.type,callback:function(t){e.$set(e.filters,"type",t)},expression:"filters.type"}},e._l(e.subjectTypesWithAll,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}))],1)],1),e._v(" "),a("el-col",{attrs:{span:8}},[a("el-col",{attrs:{span:6}},[e._v("所属栏目:")]),e._v(" "),a("el-col",{attrs:{span:16}},[a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择",clearable:!0},model:{value:e.filters.directoryId,callback:function(t){e.$set(e.filters,"directoryId",t)},expression:"filters.directoryId"}},e._l(e.columnList,function(e){return a("el-option",{key:e.id,attrs:{label:e.directoryName,value:e.id}})}))],1)],1)],1)],1)],1),e._v(" "),a("el-row",{staticStyle:{"margin-top":"30px"},attrs:{slot:"searchBar"},slot:"searchBar"},[a("el-button",{attrs:{size:"medium",icon:"el-icon-search",type:"primary"},on:{click:e.filter}},[e._v("查询")]),e._v(" "),a("el-button",{attrs:{size:"medium",type:"success"},on:{click:e.addNewSpecial}},[e._v("创建专题")])],1),e._v(" "),a("el-table-column",{attrs:{prop:"id",label:"专题ID"}}),e._v(" "),a("el-table-column",{attrs:{label:"专题样式"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-col",[e._v(e._s(e.parseType(t)))])]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"topicName",label:"专题名称"}}),e._v(" "),a("el-table-column",{attrs:{prop:"directoryId",formatter:e.formatterDirectoryName,label:"所属栏目"}}),e._v(" "),a("el-table-column",{attrs:{prop:"articleNum",label:"手动关联资讯数"}}),e._v(" "),a("el-table-column",{attrs:{label:"状态"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-col",[e._v(e._s(e.statusText(t)))])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"创建时间"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n\t\t\t\t"+e._s(e._f("date")(t.row.gmtCreated))+"\n\t\t\t")]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"权重",prop:"weight",width:"60"}}),e._v(" "),a("el-table-column",{attrs:{label:"操作",width:"140"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(a){e.previewArticle(t.row)}}},[e._v("预览")]),e._v(" "),a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(a){e.editSpecial(t.row)}}},[e._v("编辑")]),e._v(" "),"01"==t.row.status?a("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(a){e.changeStatus("offline",t.row)}}},[e._v("下线")]):e._e(),e._v(" "),"02"==t.row.status?a("el-button",{attrs:{size:"mini",type:"success"},on:{click:function(a){e.changeStatus("online",t.row)}}},[e._v("上线")]):e._e(),e._v(" "),a("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(a){e.deleteSpecial(t.row)}}},[e._v("删除")])]}}])})],1),e._v(" "),a("el-dialog",{attrs:{title:"添加专题",visible:e.dialogVisiblePage,width:"600px",top:"5vh"},on:{"update:visible":function(t){e.dialogVisiblePage=t},close:e.hideDialog}},[a("el-row",[a("el-row",[a("el-form",{ref:"form",attrs:{model:e.subForm,rules:e.formValidate,"label-position":"left","label-width":"120px"}},[a("el-row",{attrs:{type:"flex",align:"middle"}},[a("el-form-item",{staticStyle:{width:"100%"},attrs:{label:"专题样式",prop:"type"}},[a("el-col",{attrs:{span:22}},[a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择"},model:{value:e.subForm.type,callback:function(t){e.$set(e.subForm,"type",t)},expression:"subForm.type"}},e._l(e.subjectTypes,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}))],1)],1)],1),e._v(" "),a("el-row",{attrs:{type:"flex",align:"middle"}},[a("el-form-item",{staticStyle:{width:"100%"},attrs:{label:"所属栏目",prop:"directoryId"}},[a("el-col",{attrs:{span:22}},[a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择"},model:{value:e.subForm.directoryId,callback:function(t){e.$set(e.subForm,"directoryId",t)},expression:"subForm.directoryId"}},e._l(e.columnList,function(e){return a("el-option",{key:e.id,attrs:{label:e.directoryName,value:e.id}})}))],1)],1)],1),e._v(" "),"03"===e.subForm.type?a("el-row",{attrs:{type:"flex",align:"middle"}},[a("el-form-item",{staticStyle:{width:"100%"},attrs:{label:"开启评论",prop:"isOpenComments"}},[a("el-col",{attrs:{span:22}},[a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"是否开启评论"},model:{value:e.subForm.isOpenComments,callback:function(t){e.$set(e.subForm,"isOpenComments",t)},expression:"subForm.isOpenComments"}},[a("el-option",{attrs:{label:"关闭",value:"01"}}),e._v(" "),a("el-option",{attrs:{label:"开启",value:"02"}})],1)],1)],1)],1):e._e(),e._v(" "),a("el-row",{attrs:{type:"flex",align:"middle"}},[a("el-form-item",{staticStyle:{width:"100%"},attrs:{label:"专题封面",prop:"topicCover"}},[a("el-col",{attrs:{span:22}},[a("div",{staticClass:"img-tip"},[e._v("* 建议宽高690:180")]),e._v(" "),a("el-upload",{staticClass:"avatar-uploader",attrs:{action:e.ajaxUrl.baseUrl+e.ajaxUrl.uploadArticleImage,"show-file-list":!1,"on-success":e.handleAvatarSuccess,"before-upload":e.beforeAvatarUpload}},[e.subForm.topicCover?a("img",{staticClass:"avatar",attrs:{src:e.subForm.topicCover}}):a("i",{staticClass:"el-icon-plus avatar-uploader-icon"})])],1)],1)],1),e._v(" "),a("el-row",{attrs:{type:"flex",align:"middle"}},[a("el-form-item",{staticStyle:{width:"100%"},attrs:{label:"专题名称",prop:"topicName"}},[a("el-col",{attrs:{span:22}},[a("div",{staticClass:"img-tip"},[e._v("* 少于40个字")]),e._v(" "),a("el-input",{attrs:{maxlength:40},model:{value:e.subForm.topicName,callback:function(t){e.$set(e.subForm,"topicName",t)},expression:"subForm.topicName"}})],1)],1)],1),e._v(" "),"02"!==e.subForm.type?a("el-row",{attrs:{type:"flex",align:"middle"}},[a("el-form-item",{staticStyle:{width:"100%"},attrs:{label:"摘要",prop:"topicAbstract"}},[a("el-col",{attrs:{span:22}},[a("el-input",{attrs:{type:"textarea",rows:2,placeholder:"限40个字"},model:{value:e.subForm.topicAbstract,callback:function(t){e.$set(e.subForm,"topicAbstract",t)},expression:"subForm.topicAbstract"}})],1)],1)],1):e._e(),e._v(" "),a("el-row",{attrs:{type:"flex",align:"middle"}},[a("el-form-item",{staticStyle:{width:"100%"},attrs:{label:"状态",prop:"status"}},[a("el-col",{attrs:{span:22}},[a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择"},model:{value:e.subForm.status,callback:function(t){e.$set(e.subForm,"status",t)},expression:"subForm.status"}},e._l(e.options,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}))],1)],1)],1),e._v(" "),a("el-row",{attrs:{type:"flex",align:"middle"}},[a("el-form-item",{staticStyle:{width:"100%"},attrs:{label:"专题权重",prop:"weight"}},[a("el-col",{attrs:{span:22}},[a("el-input",{attrs:{type:"number",placeholder:"请输入0-100"},model:{value:e.subForm.weight,callback:function(t){e.$set(e.subForm,"weight",t)},expression:"subForm.weight"}})],1)],1)],1),e._v(" "),a("el-row",{attrs:{type:"flex",align:"middle"}},[a("el-form-item",{staticStyle:{width:"100%"},attrs:{label:"有效期"}},[a("el-col",{attrs:{span:22}},[a("el-date-picker",{attrs:{type:"datetimerange","value-format":"yyyy-MM-dd HH:mm:ss","range-separator":"-","start-placeholder":"开始日期","end-placeholder":"结束日期",align:"right"},model:{value:e.subForm.dateTimeRange,callback:function(t){e.$set(e.subForm,"dateTimeRange",t)},expression:"subForm.dateTimeRange"}})],1)],1)],1),e._v(" "),a("el-row",{staticClass:"marginBottom",attrs:{type:"flex",align:"middle"}},[a("el-col",{attrs:{span:15}},[e._v('专题资讯id（多条资讯使用英文逗号","隔开）')])],1),e._v(" "),a("el-row",{attrs:{type:"flex",align:"middle"}},[a("el-form-item",{staticStyle:{width:"100%"},attrs:{prop:"articleList"}},[a("el-col",{attrs:{span:22}},[a("el-input",{attrs:{type:"textarea",rows:12,placeholder:"请输入内容"},model:{value:e.subForm.articleList,callback:function(t){e.$set(e.subForm,"articleList",t)},expression:"subForm.articleList"}})],1)],1)],1),e._v(" "),"03"!==e.subForm.type?a("el-row",{attrs:{type:"flex",align:"middle"}},[a("el-form-item",{staticStyle:{width:"100%"},attrs:{label:"动态更新标签:",prop:"labels"}},[a("el-col",{attrs:{span:22}},[a("el-select",{staticStyle:{width:"100%"},attrs:{filterable:"",multiple:"",remote:"","remote-method":e.debounceFunc(e.queryLabels,300,!1),placeholder:"请选择标签"},model:{value:e.subForm.labelIds,callback:function(t){e.$set(e.subForm,"labelIds",t)},expression:"subForm.labelIds"}},e._l(e.labelList,function(e,t){return a("el-option",{key:t,attrs:{label:e.labelName,value:e.labelName}})}))],1)],1)],1):e._e(),e._v(" "),"03"===e.subForm.type?a("el-row",{attrs:{type:"flex",align:"middle"}},[a("el-form-item",{staticStyle:{width:"100%"},attrs:{label:"功能组件ID:"}},[a("el-col",{attrs:{span:22}},[a("el-input",{attrs:{placeholder:"多个组件用逗号隔开"},model:{value:e.subForm.componentsIds,callback:function(t){e.$set(e.subForm,"componentsIds",t)},expression:"subForm.componentsIds"}})],1)],1)],1):e._e()],1)],1),e._v(" "),a("div",{staticClass:"dialog-footer",staticStyle:{"margin-top":"30px","text-align":"center"}},[a("el-button",{on:{click:e.cancelDialog}},[e._v("取 消")]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:e.saveSpecial}},[e._v("确 定")])],1)],1)],1),e._v(" "),a("el-dialog",{attrs:{visible:e.previewArticleData.isShow,width:"30%"},on:{"update:visible":function(t){e.$set(e.previewArticleData,"isShow",t)}}},[a("img",{attrs:{width:"100%",src:e.previewArticleData.qrBase64,alt:""}})])],1)},staticRenderFns:[]};var m=a("VU/8")(p,d,!1,function(e){a("ZVgR")},"data-v-98e945a6",null);t.default=m.exports},MznX:function(e,t,a){"use strict";a.d(t,"a",function(){return l}),a.d(t,"b",function(){return i}),a.d(t,"c",function(){return s});var l=[{label:"全部",value:""},{label:"草稿",value:"01"},{label:"上线",value:"04"},{label:"下线",value:"05"}],i=[{value:"01",label:"样式一（文字）"},{value:"02",label:"样式二（栏目）"},{value:"03",label:"样式三（PK）"},{value:"04",label:"样式四（视频）"}],s=[{value:"",label:"全部"},{value:"01",label:"样式一（文字）"},{value:"02",label:"样式二（栏目）"},{value:"03",label:"样式三（PK）"},{value:"04",label:"样式四（视频）"}]},ZVgR:function(e,t){}});
//# sourceMappingURL=4.js.map